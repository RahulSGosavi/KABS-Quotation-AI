# Supabase Database Setup

To fix the "Table not found" errors, you must create the required tables in your Supabase project.

## Instructions

1. Go to your [Supabase Dashboard](https://supabase.com/dashboard).
2. Open your project.
3. Go to the **SQL Editor** (icon on the left sidebar).
4. Click **New Query**.
5. Copy and paste the SQL script below into the editor.
6. Click **Run**.

## SQL Script

```sql
-- 1. Create Cabinet Lines Table
CREATE TABLE IF NOT EXISTS public.cabinet_lines (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    tier TEXT NOT NULL,
    description TEXT,
    finish TEXT,
    multiplier NUMERIC DEFAULT 1.0,
    finish_premium NUMERIC DEFAULT 0,
    shipping_factor NUMERIC DEFAULT 0,
    catalog_excel JSONB,
    guidelines_pdf JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. Create Pricing Items Table
CREATE TABLE IF NOT EXISTS public.pricing_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    line_id TEXT REFERENCES public.cabinet_lines(id) ON DELETE CASCADE,
    type TEXT,
    sku TEXT,
    price NUMERIC,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 3. Enable Row Level Security (RLS)
ALTER TABLE public.cabinet_lines ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.pricing_items ENABLE ROW LEVEL SECURITY;

-- Drop existing policies to avoid conflicts if re-running
DROP POLICY IF EXISTS "Allow public read access" ON public.cabinet_lines;
DROP POLICY IF EXISTS "Allow public read access pricing" ON public.pricing_items;
DROP POLICY IF EXISTS "Allow full access lines" ON public.cabinet_lines;
DROP POLICY IF EXISTS "Allow full access pricing" ON public.pricing_items;

-- Create Policies
-- Allow public read access (for demo purposes)
CREATE POLICY "Allow public read access" ON public.cabinet_lines FOR SELECT USING (true);
CREATE POLICY "Allow public read access pricing" ON public.pricing_items FOR SELECT USING (true);

-- Allow full access for service role and authenticated users
-- In a real app, strict RLS should be applied based on user ID or roles.
CREATE POLICY "Allow full access lines" ON public.cabinet_lines USING (true) WITH CHECK (true);
CREATE POLICY "Allow full access pricing" ON public.pricing_items USING (true) WITH CHECK (true);

-- 4. Create Storage Bucket for Catalog Files
INSERT INTO storage.buckets (id, name, public) 
VALUES ('manufacturer-assets', 'manufacturer-assets', true)
ON CONFLICT (id) DO NOTHING;

-- 5. Storage Policies
DROP POLICY IF EXISTS "Public Access" ON storage.objects;
DROP POLICY IF EXISTS "Upload Access" ON storage.objects;
DROP POLICY IF EXISTS "Update Access" ON storage.objects;
DROP POLICY IF EXISTS "Delete Access" ON storage.objects;

CREATE POLICY "Public Access" ON storage.objects FOR SELECT USING ( bucket_id = 'manufacturer-assets' );
CREATE POLICY "Upload Access" ON storage.objects FOR INSERT WITH CHECK ( bucket_id = 'manufacturer-assets' );
CREATE POLICY "Update Access" ON storage.objects FOR UPDATE USING ( bucket_id = 'manufacturer-assets' );
CREATE POLICY "Delete Access" ON storage.objects FOR DELETE USING ( bucket_id = 'manufacturer-assets' );
```
